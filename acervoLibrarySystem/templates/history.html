<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hist√≥rico Completo</title>
    <link rel="stylesheet" href="/static/style.css?v=27">
    <script src="/static/notify.js?v=17"></script>
    <script src="/static/history.js?v=17"></script>
</head>
<body class="history-page">
    <div class="container">
        <header class="app-header" style="margin-bottom: 1rem;">
            <div class="logo">üìö</div>
            <div class="app-header-text">
                <h1 style="font-size: 1.8rem; margin: 0;">Hist√≥rico Completo</h1>
                <p class="tagline" style="font-size: 0.9rem;">Registros de adi√ß√µes, empr√©stimos e devolu√ß√µes</p>
            </div>
            <a href="#" onclick="goBackToSystem()" style="margin-left: auto; text-decoration: none; color: #4299e1;">‚Üê Voltar ao Sistema</a>
        </header>

        <!-- Layout de 2 colunas: Filtros √† esquerda, Lista √† direita -->
        <div class="history-main-grid">
            <!-- Coluna de Filtros e Controles -->
            <aside class="history-sidebar">
                <!-- Bot√£o para abrir Estat√≠sticas -->
                <button id="open-stats-modal" class="btn-open-stats" title="Ver estat√≠sticas do sistema">
                    üìä Ver Estat√≠sticas
                </button>

                <!-- Card de Filtros Compacto -->
                <div class="history-filters-card compact-filters">
                    <button class="filter-toggle" id="filter-toggle" aria-expanded="false" type="button">
                        <span class="filter-toggle-content">
                            <span class="filter-icon">üîç</span>
                            <span class="filter-title">Filtros</span>
                            <span class="filter-badge" id="active-filters-count"></span>
                        </span>
                        <span class="filter-arrow">‚ñº</span>
                    </button>
                    
                    <div class="filters-content" id="filters-content">
                        <!-- Pesquisa r√°pida -->
                        <div class="filter-group compact search-filter">
                            <label for="search-history">Pesquisar</label>
                            <input type="text" id="search-history" placeholder="T√≠tulo, autor ou ISBN..." aria-label="Pesquisar hist√≥rico">
                        </div>

                        <!-- Grade de filtros compacta -->
                        <div class="filters-grid">
                            <div class="filter-group compact">
                                <label for="filter-type">Tipo</label>
                                <select id="filter-type" aria-label="Filtrar por tipo">
                                    <option value="all">Todas</option>
                                    <option value="added">üìö Adicionados</option>
                                    <option value="borrowed">üìñ Emprestados</option>
                                    <option value="returned">‚úÖ Devolvidos</option>
                                </select>
                            </div>

                            <div class="filter-group compact">
                                <label for="filter-category">Categoria</label>
                                <select id="filter-category" aria-label="Filtrar por categoria">
                                    <option value="all">Todas</option>
                                </select>
                            </div>

                            <div class="filter-group compact">
                                <label for="sort-by">Ordenar</label>
                                <select id="sort-by" aria-label="Ordenar por">
                                    <option value="newest">Recentes</option>
                                    <option value="oldest">Antigos</option>
                                    <option value="title">A-Z</option>
                                </select>
                            </div>
                        </div>

                        <!-- Filtro de per√≠odo -->
                        <div class="filter-group compact period-filter">
                            <div class="date-range-compact">
                                <input type="date" id="from-date" aria-label="Data in√≠cio">
                                <span>‚Üí</span>
                                <input type="" id="to-date" aria-label="Data fim">
                            </div>
                        </div>

                        <button id="clear-filters" class="btn-clear-filters compact" type="button">
                            <span>üîÑ</span> Limpar Filtros
                        </button>
                    </div>
                </div>

                <!-- Card de Exporta√ß√£o -->
                <div class="history-export-card">
                    <h3 style="margin: 0 0 0.8rem 0; font-size: 0.95rem; color: #1a365d; display: flex; align-items: center; gap: 0.5rem;">
                        <span>üíæ</span> Exportar
                    </h3>
                    
                    <div class="filter-group compact">
                        <label for="export-scope">Escopo</label>
                        <select id="export-scope" title="Escopo da exporta√ß√£o">
                            <option value="filtered">Filtrados</option>
                            <option value="page">P√°gina atual</option>
                            <option value="all">Tudo</option>
                        </select>
                    </div>

                    <div class="export-buttons">
                        <button id="export-to-docs" class="btn-export btn-export-docs" title="Exportar para docs">
                            üìù Exportar CSV
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Coluna Principal: Lista de Hist√≥rico -->
            <main class="history-main-content">
                <div class="history-header">
                    <div class="history-title-section">
                        <h2 style="margin: 0; font-size: 1.2rem; color: #1a365d;">üìã Registros</h2>
                        <div class="section-title" style="margin-left: 1rem;">
                            Total: <span id="summary-count" class="count-badge">0</span>
                        </div>
                    </div>
                    <button id="load-more" class="btn-load-more" style="display:none;">Carregar mais</button>
                </div>

                <div id="history-list" class="history-list-modern" aria-live="polite"></div>
            </main>
        </div>

        <!-- Modal de Estat√≠sticas -->
        <div id="stats-modal" class="modal" aria-hidden="true">
            <div class="modal-content stats-modal-content" role="dialog" aria-modal="true" aria-labelledby="stats-modal-title">
                <header class="modal-header stats-modal-header">
                    <h2 id="stats-modal-title" style="display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                        üìä Estat√≠sticas do Sistema
                    </h2>
                    <button class="modal-close stats-modal-close" id="stats-modal-close" aria-label="Fechar">√ó</button>
                </header>
                <div class="modal-body stats-modal-body">
                    <!-- Grid de Cards de Estat√≠sticas -->
                    <div class="stats-modal-grid">
                        <div class="stat-card-modal stat-card-added">
                            <div class="stat-card-header">
                                <div class="stat-icon-modal">üìö</div>
                                <div class="stat-label-modal">Livros Adicionados</div>
                            </div>
                            <div class="stat-value-modal" id="stat-added">0</div>
                            <div class="stat-description">Total de livros no sistema</div>
                        </div>
                        
                        <div class="stat-card-modal stat-card-borrowed">
                            <div class="stat-card-header">
                                <div class="stat-icon-modal">üìñ</div>
                                <div class="stat-label-modal">Emprestados</div>
                            </div>
                            <div class="stat-value-modal" id="stat-borrowed">0</div>
                            <div class="stat-description">Livros atualmente emprestados</div>
                        </div>
                        
                        <div class="stat-card-modal stat-card-returned">
                            <div class="stat-card-header">
                                <div class="stat-icon-modal">‚úÖ</div>
                                <div class="stat-label-modal">Devolvidos</div>
                            </div>
                            <div class="stat-value-modal" id="stat-returned">0</div>
                            <div class="stat-description">Total de devolu√ß√µes registradas</div>
                        </div>
                    </div>

                    <!-- Informa√ß√µes Adicionais -->
                    <div class="stats-info-section">
                        <h3 style="margin: 0 0 1rem 0; font-size: 1rem; color: #1a365d; display: flex; align-items: center; gap: 0.5rem;">
                            üìà Vis√£o Geral
                        </h3>
                        <div class="stats-summary-grid">
                            <div class="summary-item">
                                <span class="summary-label">Taxa de Empr√©stimo</span>
                                <span class="summary-value" id="loan-rate">0%</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Taxa de Devolu√ß√£o</span>
                                <span class="summary-value" id="return-rate">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rodap√© do Modal -->
                    <div class="stats-modal-footer">
                        <p style="margin: 0; text-align: center; color: #718096; font-size: 0.85rem;">
                            üí° Dados atualizados em tempo real
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de alunos -->
        <div id="students-modal" class="modal" aria-hidden="true">
            <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="students-modal-title">
                <header class="modal-header">
                    <h2 id="students-modal-title">Alunos do sistema</h2>
                    <button class="modal-close" id="students-modal-close" aria-label="Fechar">√ó</button>
                </header>
                <div class="modal-body">
                    <div id="students-modal-list" class="students-list muted">Carregando alunos...</div>
                    <div style="display:flex;gap:0.5rem;margin-top:1rem;">
                        <input type="text" id="students-modal-new-name" placeholder="Nome do aluno" class="small-select" aria-label="Nome do aluno">
                        <button id="students-modal-add" class="btn">Adicionar</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="notification-container"></div>
    </div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'94dad6462974f231',t:'MTc0OTU3OTE0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>